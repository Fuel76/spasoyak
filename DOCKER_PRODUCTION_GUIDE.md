# =============================================================================
# MONASTYR PROJECT - PRODUCTION DOCKER COMPOSE SETUP
# =============================================================================

## ๐ ะะฑะทะพั

ะญัะพั ะฟัะพะตะบั ัะตะฟะตัั ะฟะพะปะฝะพัััั ะฝะฐัััะพะตะฝ ะดะปั ัะฐะทะฒะตัััะฒะฐะฝะธั ัะตัะตะท Docker Compose ะฒ ะฟัะพะดะฐะบัะตะฝะต. 

### ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   Frontend      โ    โ    Backend      โ    โ    Database     โ
โ   (Nginx +      โโโโโบโ   (Express +    โโโโโบโ    (MySQL)      โ
โ   React)        โ    โ   TypeScript)   โ    โ                 โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ                       โ
         โโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                     โโโโโโโโโโโโโโโโโโโ
                     โ     Redis       โ
                     โ   (ะะตัะธัะพะฒะฐะฝะธะต) โ
                     โโโโโโโโโโโโโโโโโโโ
```

### ๐ ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
โโโ docker-compose.yml          # ะัะพะดะฐะบัะฝ ะบะพะฝัะธะณััะฐัะธั
โโโ docker-compose.dev.yml      # ะะพะฝัะธะณััะฐัะธั ะดะปั ัะฐะทัะฐะฑะพัะบะธ
โโโ .env.production             # ะจะฐะฑะปะพะฝ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั ะดะปั ะฟัะพะดะฐะบัะฝะฐ
โโโ .env.development            # ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะดะปั ัะฐะทัะฐะฑะพัะบะธ
โโโ deploy.sh                   # ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั
โโโ backend/
โ   โโโ Dockerfile              # ะัะพะดะฐะบัะฝ ะพะฑัะฐะท backend
โ   โโโ Dockerfile.dev          # ะะฑัะฐะท backend ะดะปั ัะฐะทัะฐะฑะพัะบะธ
โโโ webapp/
โ   โโโ Dockerfile              # ะัะพะดะฐะบัะฝ ะพะฑัะฐะท frontend
โ   โโโ Dockerfile.dev          # ะะฑัะฐะท frontend ะดะปั ัะฐะทัะฐะฑะพัะบะธ
โ   โโโ nginx.conf              # ะะพะฝัะธะณััะฐัะธั Nginx
โโโ mysql/
โ   โโโ my.cnf                  # ะะพะฝัะธะณััะฐัะธั MySQL
โโโ scripts/
    โโโ backup.sh               # ะะฒัะพะผะฐัะธัะตัะบะพะต ัะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต
    โโโ restore.sh              # ะะพัััะฐะฝะพะฒะปะตะฝะธะต ะธะท ะฑัะบะฐะฟะฐ
    โโโ monitor.sh              # ะะพะฝะธัะพัะธะฝะณ ัะธััะตะผั
```

## ๐ ะัััััะน ััะฐัั

### 1. ะะพะดะณะพัะพะฒะบะฐ ะบ ะฟัะพะดะฐะบัะฝั

```bash
# ะะพะฟะธัะพะฒะฐะฝะธะต ัะฐะฑะปะพะฝะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
cp .env.production .env

# ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะฝะฐัััะพะตะบ (ะะะฏะะะขะะะฌะะ!)
nano .env
```

### 2. ะะฐะฟััะบ ะฒ ะฟัะพะดะฐะบัะฝะต

```bash
# ะะฒัะพะผะฐัะธัะตัะบะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต
./deploy.sh

# ะะปะธ ะฒัััะฝัั
docker-compose up -d
```

### 3. ะะฐะฟััะบ ะฒ ัะฐะทัะฐะฑะพัะบะต

```bash
# ะะพะฟะธัะพะฒะฐะฝะธะต ะฟะตัะตะผะตะฝะฝัั ะดะปั ัะฐะทัะฐะฑะพัะบะธ
cp .env.development .env

# ะะฐะฟััะบ ะฒ ัะตะถะธะผะต ัะฐะทัะฐะฑะพัะบะธ
docker-compose -f docker-compose.dev.yml up -d
```

## ๐ง ะฃะฟัะฐะฒะปะตะฝะธะต

### ะัะฝะพะฒะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะกัะฐััั ัะตัะฒะธัะพะฒ
./deploy.sh status

# ะะพะฝะธัะพัะธะฝะณ ัะธััะตะผั
./scripts/monitor.sh

# ะะตะฟัะตััะฒะฝัะน ะผะพะฝะธัะพัะธะฝะณ
./scripts/monitor.sh watch

# ะัะพัะผะพัั ะปะพะณะพะฒ
docker-compose logs -f

# ะะตัะตะทะฐะฟััะบ
./deploy.sh restart

# ะััะฐะฝะพะฒะบะฐ
./deploy.sh stop
```

### ะะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต

```bash
# ะกะพะทะดะฐะฝะธะต ะฑัะบะฐะฟะฐ
./scripts/backup.sh

# ะะพัััะฐะฝะพะฒะปะตะฝะธะต
./scripts/restore.sh /app/backups/backup_20250702_120000.sql.gz
```

## ๐ ะะพัััะฟ ะบ ัะตัะฒะธัะฐะผ

- **Frontend**: http://localhost:80 (https://localhost:443 ั SSL)
- **Backend API**: http://localhost:3000
- **ะะฐะทะฐ ะดะฐะฝะฝัั**: localhost:3306
- **Redis**: localhost:6379

## ๐ ะะตะทะพะฟะฐัะฝะพััั

### ะะฐัััะพะตะฝะฝัะต ะผะตัั ะฑะตะทะพะฟะฐัะฝะพััะธ:

- โ Helmet.js ะดะปั ะทะฐัะธัั HTTP ะทะฐะณะพะปะพะฒะบะพะฒ
- โ CORS ะฝะฐัััะพะตะฝ ะฟัะฐะฒะธะปัะฝะพ
- โ Rate limiting ะดะปั API
- โ JWT ะฐััะตะฝัะธัะธะบะฐัะธั
- โ ะฅะตัะธัะพะฒะฐะฝะธะต ะฟะฐัะพะปะตะน ัะตัะตะท bcrypt
- โ ะะฐะปะธะดะฐัะธั ะฒัะตั ะฒัะพะดะฝัั ะดะฐะฝะฝัั
- โ ะะฐะฟััะบ ะบะพะฝัะตะนะฝะตัะพะฒ ะฑะตะท root ะฟัะฐะฒ
- โ SSL ัะตััะธัะธะบะฐัั (ัะฐะผะพะฟะพะดะฟะธัะฐะฝะฝัะต ะดะปั ัะฐะทัะฐะฑะพัะบะธ)

### ะะตะบะพะผะตะฝะดะฐัะธะธ ะดะปั ะฟัะพะดะฐะบัะฝะฐ:

1. **ะัะฟะพะปัะทัะนัะต ัะตะฐะปัะฝัะต SSL ัะตััะธัะธะบะฐัั** (Let's Encrypt)
2. **ะะฐัััะพะนัะต ัะฐะตัะฒะพะป** ะฝะฐ ัะตัะฒะตัะต
3. **ะะตะณัะปััะฝะพ ะพะฑะฝะพะฒะปัะนัะต** ะทะฐะฒะธัะธะผะพััะธ
4. **ะะฐัััะพะนัะต ะผะพะฝะธัะพัะธะฝะณ** ะธ ะฐะปะตััั
5. **ะะตะปะฐะนัะต ัะตะณัะปััะฝัะต ะฑัะบะฐะฟั**

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะัััะพะตะฝะฝัะต health checks:

- โ Backend API health endpoint
- โ Database connectivity check
- โ Frontend availability check
- โ Redis availability check

### ะะพะณะธัะพะฒะฐะฝะธะต:

- ะัะต ะปะพะณะธ ะดะพัััะฟะฝั ัะตัะตะท `docker-compose logs`
- Nginx ะปะพะณะธ ั ะฟะพะดัะพะฑะฝะพะน ะธะฝัะพัะผะฐัะธะตะน ะพ ะทะฐะฟัะพัะฐั
- MySQL slow query log ะฒะบะปััะตะฝ
- ะะฒัะพะผะฐัะธัะตัะบะฐั ัะพัะฐัะธั ะปะพะณะพะฒ

## ๐ CI/CD

ะะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั ะผะพะถะฝะพ ะฝะฐัััะพะธัั:

```yaml
# ะัะธะผะตั GitHub Actions
- name: Deploy to production
  run: |
    ./deploy.sh
    ./scripts/monitor.sh health
```

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะะฟัะธะผะธะทะฐัะธะธ:

- โ Gzip ัะถะฐัะธะต ะฒ Nginx
- โ ะะตัะธัะพะฒะฐะฝะธะต ััะฐัะธัะตัะบะธั ัะฐะนะปะพะฒ
- โ Redis ะดะปั ะบะตัะธัะพะฒะฐะฝะธั ะดะฐะฝะฝัั
- โ ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต Docker ะพะฑัะฐะทั
- โ MySQL ะฝะฐัััะพะนะบะธ ะดะปั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
- โ ะกะพะตะดะธะฝะตะฝะธะต pooling

### ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต:

ะะปั ะณะพัะธะทะพะฝัะฐะปัะฝะพะณะพ ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั:

```bash
# ะะฐะฟััะบ ะฝะตัะบะพะปัะบะธั ัะบะทะตะผะฟะปััะพะฒ backend
docker-compose up -d --scale backend=3
```

## ๐๏ธ ะะฑัะปัะถะธะฒะฐะฝะธะต

### ะะฑะฝะพะฒะปะตะฝะธะต:

```bash
# ะะฑะฝะพะฒะปะตะฝะธะต ะบะพะดะฐ
git pull
./deploy.sh

# ะะฑะฝะพะฒะปะตะฝะธะต ัะพะปัะบะพ backend
docker-compose build backend
docker-compose up -d backend

# ะะฑะฝะพะฒะปะตะฝะธะต ัะพะปัะบะพ frontend
docker-compose build frontend
docker-compose up -d frontend
```

### ะัะธััะบะฐ:

```bash
# ะะพะปะฝะฐั ะพัะธััะบะฐ (ะฃะะะะฏะะข ะะกะ ะะะะะซะ!)
./deploy.sh clean
```

## ๐ ะฃัััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ

### ะงะฐัััะต ะฟัะพะฑะปะตะผั:

1. **ะะพะฝัะตะนะฝะตั ะฝะต ะทะฐะฟััะบะฐะตััั**: ะัะพะฒะตัััะต ะปะพะณะธ `docker-compose logs [service]`
2. **ะะฐะทะฐ ะดะฐะฝะฝัั ะฝะตะดะพัััะฟะฝะฐ**: ะฃะฑะตะดะธัะตัั, ััะพ MySQL ะบะพะฝัะตะนะฝะตั ะทะฐะฟััะตะฝ
3. **502 ะพัะธะฑะบะฐ**: Backend ะฝะตะดะพัััะฟะตะฝ, ะฟัะพะฒะตัััะต ะตะณะพ ััะฐััั
4. **ะะตั ะดะพัััะฟะฐ ะบ ัะฐะนะปะฐะผ**: ะัะพะฒะตัััะต ะฟัะฐะฒะฐ ะดะพัััะฟะฐ ะบ volumes

### ะัะปะฐะดะบะฐ:

```bash
# ะะพะดะบะปััะตะฝะธะต ะบ ะบะพะฝัะตะนะฝะตัั
docker-compose exec backend sh
docker-compose exec frontend sh
docker-compose exec db mysql -u root -p

# ะัะพะฒะตัะบะฐ ัะตัะตะฒะพะณะพ ะฟะพะดะบะปััะตะฝะธั
docker-compose exec backend ping db
docker-compose exec frontend ping backend
```

---

## ๐ ะะพะดะดะตัะถะบะฐ

ะะปั ะฟะพะปััะตะฝะธั ะฟะพะผะพัะธ:

1. ะัะพะฒะตัััะต ะปะพะณะธ: `docker-compose logs`
2. ะะฐะฟัััะธัะต ะผะพะฝะธัะพัะธะฝะณ: `./scripts/monitor.sh`
3. ะัะพะฒะตัััะต ะบะพะฝัะธะณััะฐัะธั ะฒ `.env` ัะฐะนะปะต

**ะัะพะตะบั ะณะพัะพะฒ ะบ ะฟัะพะดะฐะบัะฝั! ๐**
