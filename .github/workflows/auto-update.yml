name: üîÑ Auto Update Dependencies

on:
  schedule:
    # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 9:00 UTC
    - cron: '0 9 * * 1'
  workflow_dispatch:

jobs:
  update-dependencies:
    name: üì¶ Update Dependencies
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: üü¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: üì¶ Setup pnpm
      uses: pnpm/action-setup@v2
      with:
        version: '8'

    - name: üì• Install dependencies
      run: pnpm install --frozen-lockfile

    - name: üîÑ Update dependencies
      run: |
        pnpm update --latest
        pnpm audit fix || true

    - name: üß™ Run tests after update
      run: |
        pnpm b types
        pnpm w types
        pnpm b lint
        pnpm w lint

    - name: üìù Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: üì¶ Update dependencies
        title: 'üì¶ Auto-update dependencies'
        body: |
          ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
          
          –≠—Ç–æ—Ç PR —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞:
          
          - –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –ø–∞–∫–µ—Ç—ã –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏–π
          - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–µ—Å–ª–∏ –±—ã–ª–∏)
          - –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ç–µ–∫—É—â–∏–º –∫–æ–¥–æ–º
          
          –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–ª–∏—è–Ω–∏–µ–º.
        branch: auto-update-dependencies
        delete-branch: true
