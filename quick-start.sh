#!/bin/bash

# =============================================================================
# QUICK START SCRIPT FOR MONASTYR PROJECT
# =============================================================================

set -e

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m'

info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

header() {
    echo -e "${CYAN}$1${NC}"
}

clear

header "üèõÔ∏è  MONASTYR PROJECT - QUICK START"
header "=================================="
echo ""

info "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ Monastyr!"
echo ""

echo "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∑–∞–ø—É—Å–∫–∞:"
echo ""
echo "1) üöÄ –ü—Ä–æ–¥–∞–∫—à–Ω (–ø–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π)"
echo "2) üõ†Ô∏è  –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (—Å hot reload –∏ –æ—Ç–ª–∞–¥–∫–æ–π)"
echo "3) üîí –ü—Ä–æ–¥–∞–∫—à–Ω —Å HTTPS (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL)"
echo "4) üìä –¢–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)"
echo "5) üßπ –û—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã (—É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö)"
echo ""

read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –æ–ø—Ü–∏–∏ (1-5): " choice

case $choice in
    1)
        header "üöÄ –ó–ê–ü–£–°–ö –í –†–ï–ñ–ò–ú–ï –ü–†–û–î–ê–ö–®–ù"
        echo "============================="
        echo ""
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ .env —Ñ–∞–π–ª–∞
        if [ ! -f .env ]; then
            warning "–§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞—é –∏–∑ —à–∞–±–ª–æ–Ω–∞..."
            cp .env.production .env
            warning "‚ö†Ô∏è  –í–ê–ñ–ù–û: –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º!"
            echo ""
            echo "–û—Ç–∫—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:"
            echo "- MYSQL_ROOT_PASSWORD (–ø–∞—Ä–æ–ª—å root –¥–ª—è MySQL)"
            echo "- MYSQL_PASSWORD (–ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)"
            echo "- JWT_SECRET (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT)"
            echo "- ADMIN_REGISTRATION_KEY (–∫–ª—é—á —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)"
            echo "- FRONTEND_URL –∏ VITE_API_URL (–≤–∞—à –¥–æ–º–µ–Ω)"
            echo ""
            read -p "–ù–∞–∂–º–∏—Ç–µ Enter –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è .env —Ñ–∞–π–ª–∞..."
        fi
        
        info "–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è..."
        make deploy
        
        echo ""
        success "üéâ –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
        echo ""
        echo "üì± –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:"
        echo "  Frontend: http://localhost:80"
        echo "  Backend:  http://localhost:3000"
        echo ""
        echo "üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
        echo "  make status    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞"
        echo "  make logs      # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤"
        echo "  make monitor   # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã"
        echo "  make backup    # –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏"
        ;;
    
    2)
        header "üõ†Ô∏è  –ó–ê–ü–£–°–ö –í –†–ï–ñ–ò–ú–ï –†–ê–ó–†–ê–ë–û–¢–ö–ò"
        echo "=============================="
        echo ""
        
        if [ ! -f .env ]; then
            info "–°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
            cp .env.development .env
        fi
        
        info "–ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
        make deploy-dev
        
        echo ""
        success "üéâ –†–∞–∑—Ä–∞–±–æ—Ç—á–µ—Å–∫–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!"
        echo ""
        echo "üì± –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:"
        echo "  Frontend: http://localhost:5173 (—Å hot reload)"
        echo "  Backend:  http://localhost:3000 (—Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π)"
        echo ""
        echo "üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
        echo "  make logs-dev     # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤"
        echo "  make restart-dev  # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫"
        echo "  make shell-backend # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ backend"
        ;;
    
    3)
        header "üîí –ó–ê–ü–£–°–ö –° HTTPS"
        echo "================="
        echo ""
        
        info "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤..."
        ./scripts/setup-ssl.sh
        
        info "–ó–∞–ø—É—Å–∫ —Å HTTPS..."
        make up-https
        make migrate
        
        echo ""
        success "üéâ HTTPS —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
        echo ""
        echo "üì± –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:"
        echo "  HTTP:  http://localhost:80 (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç)"
        echo "  HTTPS: https://localhost:443"
        ;;
    
    4)
        header "üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –°–ò–°–¢–ï–ú–´"
        echo "====================="
        echo ""
        
        info "–ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞..."
        make status
        
        echo ""
        echo "–•–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥? (y/n)"
        read -p "" -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            make monitor-watch
        fi
        ;;
    
    5)
        header "üßπ –û–ß–ò–°–¢–ö–ê –°–ò–°–¢–ï–ú–´"
        echo "=================="
        echo ""
        
        error "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞!"
        error "–í–∫–ª—é—á–∞—è –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏!"
        echo ""
        warning "–•–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π? (y/n)"
        read -p "" -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            info "–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏..."
            make backup
        fi
        
        echo ""
        error "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ? (yes/no)"
        read -p "–í–≤–µ–¥–∏—Ç–µ 'yes' –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: " confirm
        
        if [ "$confirm" = "yes" ]; then
            make clean
            success "–°–∏—Å—Ç–µ–º–∞ –æ—á–∏—â–µ–Ω–∞"
        else
            info "–û—á–∏—Å—Ç–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞"
        fi
        ;;
    
    *)
        error "–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–º–µ—Ä–∞ –æ—Ç 1 –¥–æ 5."
        exit 1
        ;;
esac

echo ""
header "üèõÔ∏è  –ü–û–õ–ï–ó–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø"
header "======================="
echo ""
echo "üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:"
echo "  README.md                    # –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
echo "  DOCKER_PRODUCTION_GUIDE.md  # –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ"
echo ""
echo "üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (—á–µ—Ä–µ–∑ Makefile):"
echo "  make help        # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã"
echo "  make prod        # –ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ"
echo "  make dev         # –ó–∞–ø—É—Å–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"
echo "  make status      # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞"
echo "  make logs        # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤"
echo "  make backup      # –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏"
echo "  make clean       # –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞"
echo ""
echo "üõ†Ô∏è  –ü—Ä—è–º—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "  ./deploy.sh              # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ"
echo "  ./scripts/monitor.sh     # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"
echo "  ./scripts/backup.sh      # –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ"
echo "  ./scripts/setup-ssl.sh   # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL"
echo ""
echo "üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞:"
echo "  –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:"
echo "  make logs –∏–ª–∏ docker-compose logs"
echo ""
success "–ì–æ—Ç–æ–≤–æ! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∏ –∑–∞–ø—É—â–µ–Ω–æ! üéâ"
